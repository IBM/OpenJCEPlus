/*
 * Copyright IBM Corp. 2025
 *
 * This code is free software; you can redistribute it and/or modify it
 * under the terms provided by IBM in the LICENSE file that accompanied
 * this code, including the "Classpath" Exception described therein.
 */
package ibm.jceplus.junit.base;

import ibm.security.internal.spec.RawKeySpec;
import java.io.IOException;
import java.security.InvalidKeyException;
import java.security.KeyFactory;
import java.security.KeyPair;
import java.security.KeyPairGenerator;
import java.security.PrivateKey;
import java.security.PublicKey;
import java.security.spec.PKCS8EncodedKeySpec;
import java.security.spec.X509EncodedKeySpec;
import java.util.Arrays;
import java.util.HexFormat;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.params.ParameterizedTest;
import org.junit.jupiter.params.provider.CsvSource;
import sun.security.util.DerValue;
import sun.security.x509.AlgorithmId;
import static org.junit.jupiter.api.Assertions.assertArrayEquals;
import static org.junit.jupiter.api.Assertions.fail;

public class BaseTestPQCKeys extends BaseTestJunit5 {


    protected KeyPairGenerator pqcKeyPairGen;
    protected KeyFactory pqcKeyFactory;



    @BeforeEach
    public void setUp() throws Exception {


    }

    @ParameterizedTest
    @CsvSource({"ML-KEM", "MLKEM512", "ML_KEM_768", "ML-KEM-1024",
                "ML_KEM_512", "ML_KEM_768", "ML_KEM_1024",
                "ML-DSA", "ML_DSA_44", "ML_DSA_65", "ML-DSA-87"})
    public void testPQCKeyGen(String Algorithm) throws Exception {
        if (getProviderName().equals("OpenJCEPlusFIPS")) {
            //FIPS does not support PQC keys currently
            return;
        }
        try {
            KeyPair pqcKeyPair = generateKeyPair(Algorithm);

            pqcKeyPair.getPublic();
            pqcKeyPair.getPrivate();
        } catch (Exception e) {
            throw new Exception(e.getCause() +" - "+Algorithm, e);
        }
    }

    @ParameterizedTest
    @CsvSource({"ML-KEM", "ML-KEM-512", "ML-KEM-768", "ML-KEM-1024",
                "ML-DSA", "ML_DSA_44", "ML_DSA_65", "ML-DSA-87"})
    public void testPQCKeyFactoryCreateFromEncoded(String Algorithm) throws Exception {
        if (getProviderName().equals("OpenJCEPlusFIPS")) {
            //FIPS does not support PQC keys currently
            return;
        }
        keyFactoryCreateFromEncoded(Algorithm);
    }
    @ParameterizedTest
    @CsvSource({"ML-DSA", "ML-DSA-44", "ML-DSA-65", "ML-KEM", "ML-KEM-512"})
    public void testPQCKeyFactoryCreateFromStaticEncoded(String Algorithm) throws Exception {
        if (getProviderName().equals("OpenJCEPlusFIPS")) {
            //FIPS does not support PQC keys currently
            return;
        }
        keyFactoryCreateFromStaticEncoded(Algorithm);
    }
    
    protected KeyPair generateKeyPair(String Algorithm) throws Exception {
        pqcKeyPairGen = KeyPairGenerator.getInstance(Algorithm, getProviderName());

        KeyPair keyPair = pqcKeyPairGen.generateKeyPair();
        if (keyPair.getPrivate() == null) {
            fail("Private key is null - " + Algorithm);
        }

        if (keyPair.getPublic() == null) {
            fail("Public key is null - " + Algorithm);
        }

        if (!(keyPair.getPrivate() instanceof PrivateKey)) {
            fail("Key is not a PrivateKey - " + Algorithm);
        }

        if (!(keyPair.getPublic() instanceof PublicKey)) {
            fail("Key is not a PublicKey - " + Algorithm);
        }
        //System.out.println("Pub key - "+Algorithm+ " = "+HexFormat.of().formatHex(((com.ibm.crypto.plus.provider.PQCPublicKey)(keyPair.getPublic())).getKeyBytes()));
        //System.out.println("Priv key - "+Algorithm+ " = "+HexFormat.of().formatHex(((com.ibm.crypto.plus.provider.PQCPrivateKey)(keyPair.getPrivate())).getKeyBytes()));
 
        return keyPair;
    }

    protected void keyFactoryCreateFromEncoded(String Algorithm) throws Exception {
        
        pqcKeyFactory = KeyFactory.getInstance(Algorithm, getProviderName());
        KeyPair pqcKeyPair = generateKeyPair(Algorithm);
        
        X509EncodedKeySpec x509Spec = new X509EncodedKeySpec(pqcKeyPair.getPublic().getEncoded());
        PKCS8EncodedKeySpec pkcs8Spec = new PKCS8EncodedKeySpec(
                pqcKeyPair.getPrivate().getEncoded());
        PublicKey pub =  pqcKeyFactory.generatePublic(x509Spec);
        PrivateKey priv =  pqcKeyFactory.generatePrivate(pkcs8Spec);

        assertArrayEquals(pub.getEncoded(), pqcKeyPair.getPublic().getEncoded(), "Public key does not match generated public key - "+Algorithm);
        assertArrayEquals(priv.getEncoded(), pqcKeyPair.getPrivate().getEncoded(), "Private key does not match generated public key - "+Algorithm);

    }

    protected void keyFactoryCreateFromStaticEncoded(String Algorithm) throws Exception {
        
        String privBytes = null;
        String pubBytes = null;

        switch (Algorithm) {
            case "ML-KEM-512":
                privBytes ="0482066004820664048206606e1882e6e554a64051f4a6aac561ca6dcb7c4b5b151589075a7800fd85148207220659cc77538c4acb676119117459c121c809547c1bcf9a9dd2c707c6c66d93ebb4cd0715ffe478d253274a9576d20991a7085188f6852f9c8a66033c327ac3b20b47eaa1c664cbc329080354676838d84c8ba8420ef99e93ec8c02f7432ee72eee843f42b95ea0d05eb990c261c82f6d173533a6b07ac29482c304c9ebcd50606d66335566c8ab9e5187ae06814f7848dea97516644ee606b723dbc1fc98bb6808745e3551741c5a47586c1c9ca54ac21598781e7171c5a1b98f66f99782acaf5be8951a8199fcfa81f854303b581ca42117bd41a8a1a94a0e7206e52b9eaf5b69f6a396b9d09171601465c57a54329726b9a02c3c51c4281c2581430a291cf1c86497d5c8303212cae7b085b474b866639d578505d489d936c38dec00cb78a700e75150ea5a8992c49a05790a8a9167231c97f04db84aadd30623840aa1ac72c3be43b7a68377ac12c8bc0482bae2285fd42f78221de523416d9ba1c9e13ec4727402079badf79dacdbc139d80e6875896154b6ae7b536a6aa598325360facdad1b13f8c6ae2036202d81bd5c0bcf316c56a5377aa451366b20ad95a52521c285affb0755f8b62c2b269ef5bbb8325e3be78ab9a735c8356d7a23a15b38574062081864cd9d354f1dcbc7eacb7068a55d556314b4077fe9876bc3c8c20c9491ca09066274733b47a8bb1ab570500403c0a6a738683ff399d542537c51c2aef70f24895a31a5cf4a9b06a29531e0783ce95784f337be5c068e73b78bc509c5ad8262ce042f10bb2c7fd12afd602596e41df4f22c5d8ba482007d35d08cae2372cf52cce163cdc43968712c936b8c7371da1f7bf74a6deac2f3c121ab2a22d5fa0b41c75f9b9c1cb644476c1677ac4aa66957cf6447037bc28725a25caa89193f012d2fd81247911a738149dbe58470b344ab031c75513da4ba66e1c6a9086632fa2174a9546d48c8ab4795416b16badfa0acf9157732bc47680b644fc7497256a10ea7cfb3f01c76d3128838949a1cb7d099c84e687bcdb674df263f1cda21a0ec3aa9463e47088eb02c93ef4a55b4d45addd9afd2d47856212e0c9b42f18424cdc30364b59892ba346c75a935f140ba72437e1934406b3132ec51d9d103f9696a23856147356368b6ace0ac0ed16b7f8026980038a0ee0271454b3195f4969e13b5632059b293554d8ac329563509a692180b1e40a21137a47948d61fba818572284d37a12edab8c3a5a070ac04cdc899b6b0d41175dc285fab051eb7c2c613431ce67cee1069d14c079d01cf3b250c3d88791fcb4933034deb30c76c0c00e07a1bec5191fad58c947abaf0a667a1847112f8b0cf738508a2746d6b47d7cbcde69a462c69941e5b6083121c87a6ba58211044f83932d809929314b57c3df6e00145da07f69c106e9a88d3574f661398f5a0705afab8e0f318ae28cbd44107a802649d139c0ee958b6d90fb2694ec9ba9227d85ab8f171f7157e401b9e89589a0fb7922a1a4a9f3b53a62b8d6aeccc17d011e0080f4a5a081d097bec5cb89c300286350244738c6f2c24a8a4683d60bdb5cc0631d85f0131a101a38c7b72b3c0018766561ded7c1637c67cae498485e50dbfb603b8a3b770ec104ce37e3be99b2ddcb8386ac9f984bbbc825f5353618f66c4ea25bcf98141bd8b81525395ca4a1093036ae40215ffc9b0b59274fbd9ae25a513e46396d83b9aa30455663c523187294630b4a777bf5b883ca3511f0ce0ae36483ebc41aede8b1251984b4cf335a0c60666289706d051d7f819d7f9804b898bd9c968e30153f13753fb2746e6295a2068cd6eb086226a8c7dbba74a1bb21e63ce6483cca5fa30d4d1ae50ca3b44a0954ddabb58b400989b2cdcc69c2bcb47cba43dc339008b667561caac7b7acb15b755022b8fbf2c9f0a38cd18c1c1f0296748288d11c34fd3e9019796c1292c80e794c35b96722b446878235add89cf1b7501457cc25bd65bbba2cd15b710e4b13b3b4c07eea61661188784036e79628b2a546168866db5e79da8e238aa58a554b2279ad0cace65b35bdcc18f3b84460a2021ba0adcb7573ddacd11ba3377f71a7b4c2dfe310e43a7c5aea389ea003fdaaa8245d61d25a132b1b3c7e2b88eaa0d92f8686e5131adbff3881135eeeba50156f862274721802ac49ad30ce288b5a625ef1ed1e9814a1fca936dd632aff414f5a71a734180c2565dbe87db1c817a73b359aaf424f6e64b9bd84a427f8cabe91e84d8d6f7c558746840391dc71a";
                pubBytes = "a0ec3aa9463e47088eb02c93ef4a55b4d45addd9afd2d47856212e0c9b42f18424cdc30364b59892ba346c75a935f140ba72437e1934406b3132ec51d9d103f9696a23856147356368b6ace0ac0ed16b7f8026980038a0ee0271454b3195f4969e13b5632059b293554d8ac329563509a692180b1e40a21137a47948d61fba818572284d37a12edab8c3a5a070ac04cdc899b6b0d41175dc285fab051eb7c2c613431ce67cee1069d14c079d01cf3b250c3d88791fcb4933034deb30c76c0c00e07a1bec5191fad58c947abaf0a667a1847112f8b0cf738508a2746d6b47d7cbcde69a462c69941e5b6083121c87a6ba58211044f83932d809929314b57c3df6e00145da07f69c106e9a88d3574f661398f5a0705afab8e0f318ae28cbd44107a802649d139c0ee958b6d90fb2694ec9ba9227d85ab8f171f7157e401b9e89589a0fb7922a1a4a9f3b53a62b8d6aeccc17d011e0080f4a5a081d097bec5cb89c300286350244738c6f2c24a8a4683d60bdb5cc0631d85f0131a101a38c7b72b3c0018766561ded7c1637c67cae498485e50dbfb603b8a3b770ec104ce37e3be99b2ddcb8386ac9f984bbbc825f5353618f66c4ea25bcf98141bd8b81525395ca4a1093036ae40215ffc9b0b59274fbd9ae25a513e46396d83b9aa30455663c523187294630b4a777bf5b883ca3511f0ce0ae36483ebc41aede8b1251984b4cf335a0c60666289706d051d7f819d7f9804b898bd9c968e30153f13753fb2746e6295a2068cd6eb086226a8c7dbba74a1bb21e63ce6483cca5fa30d4d1ae50ca3b44a0954ddabb58b400989b2cdcc69c2bcb47cba43dc339008b667561caac7b7acb15b755022b8fbf2c9f0a38cd18c1c1f0296748288d11c34fd3e9019796c1292c80e794c35b96722b446878235add89cf1b7501457cc25bd65bbba2cd15b710e4b13b3b4c07eea61661188784036e79628b2a546168866db5e79da8e238aa58a554b2279ad0cace65b35bdcc18f3b84460a2021ba0adcb7573ddacd11ba3377f71a7b4c2dfe310e43a7c5aea389ea003fdaaa8245d61d25a132b1b3c7e2b88eaa0d92f8686e5131adbff3881135eeeba50156f862274721802ac49ad30ce288";
                break;
            case "ML-DSA-44":
                privBytes ="0E3EA259CBF7BB2748A52234808340F4D76BE3E603BC7D6ACBB5C9A1D1A2831A1E933C9C781106773B05E9F09155A6A6D4C039D8848CD1A9E7A5ACEEED122758AEC654CFB8C2CCCBEFC427219682E6EF55321391BC2CDE6DB91B176F51C6BAC4D6B5F1B7BE0B1AAD987E3D4494B3F59D2CC140E12BDD001B43418089724197FE9C94090488115BA84DA148700B382C8A242811020CDCB249CBA8241A8129234152D940819842520B40691A204CC2B424829844C3046D03157242102C24252818C66D20A90510430A11937140A6645CB22DC4962194340423B18921A16D10156D0A1451E038928C46609A0272E0A09024110618217260C24048B449631092A31652C0100081963114912819A62081A4291C164562C2642440485B062E9B1040D29208E14426C9148C2118890C40621A320050C00120B48802C02C110212D9346688A611C40668881625131391CC0260E03286C9364C43224CD34071C8480C22A62DD2C005D02850D9040ACAA66863848412024C6498641BB9895C264E9C22244C0866C2C2480A498A4AB8640C8329DBA670C808850C41251A3612043465140470D1826512448822089153045200409264108510C36919132118116683C004481289D8C68004472214A18D22A840DAC26521200644023010A1106032281BB148CA1491A3B084DB04018CA230602070120106034429E4B27189807009086CE0026A1996906386680345244C42654B301210282504B3818A340C213948D2B80D18C168D44071DCA80C54C084184606511202C2B225D0242E1B837024C52404120A088121C828884986311A890854A26D4330042333088C1226A038619B16258A48125B140A62422C4032491B348C44823001104D631091524668E4B241A2240102194902058580406E0921600BB180D904889B266D1C32518CB88C58B441C91489E4122C49924C53087001C30D01378E102868CA2892232765C3326904104D223510221009CA0249E1B20852B8815B4410D326892393845804690B106CE0C88D64307160142E44A010A148909B247050C0211C16028C400E981625A2B20C5A042C04170251146A4106910403890B392192344D629840583431C9C0650AB40859B670210802091142C030811AA96D1905885B168AC4000291124681144904485123C300643224581292DA84894A988422B61004158060C88C033200204031C4960180C84094308E58B8699030298AC661103468D2048981168C019664944861C338068274D51469F7B87C1CB8FEC11C3308DC8A98E4D7E3FD168038EAB3DECD17F9AC0D60C69C5439B1BAB20A9C505A969F1764DE73E543A57603EEC2D33B554D5767FAB7C8C9AB062948DCB0A1FDD96AAD74BF7F96274EB64112F916140313C4854347846011E2C49FB974F9B3C1B6BA433616641829B6AD0AB67DA96BEBAE1437834C18F5DAC87E27742562D718980C96C6E60C3788F19A5835E7843460109F4748EA8EC241BD1166E073C09098682AEC4EF6C7DE5AAA6B2740780245F5D4F3E94B5C3C4B000A46624E9859DEE0A2E18EA700833D3B60885109A019C799F6AD8C93BB2C623BAB5D56E94E809E4790C86E854919B400E55BDC52527C7A57203F47482BD3809ED68C3A980EE9E1EED85975189121CFBB5C58154240748B5B0C360095BAAFB38E2D4F7849D594DB58C845A2EF98F672DC3F3E74D2E9E4DD9916BC0AE2061732A2F5B41984CAD2E48FF581C4A00E6D2D2451AE0C7E833F0C8ED1E7A2A0B97DC742428197E79C0B1E04ABB810837F2F4D327CE8F7E88AEFEE295433D4E1E8BEC392106EDC2225118BBEBD96DF634AE47601095D4B25216D3D914BD8CCB714DC00322B528E42C228B61BBB93B52510861EAD0225ABF1B5D700F3DE581CB62FE7546CB18A3AF86095BC147B4938E400A98324E0425EE02E03559AF547440BD9F5E1C3A6EDA7C126CB0321D32C170337F7BB15FBC61CF862D30D884A47E81AF2393F4371FA16652C599EBC31C27E1DA69ECC77547BCAE8439EFD83E4A269779665A31A60F3CD5A413FBB407364DFCAFD25CDD0A5F491B1A7C147DABC8BAC162975C9AC46F94F9E474F423543B4A36BD194DBB430BD669BCE37EC28EAEDFF1D8A2FBB84A71D9DBFD27365D41AE992B3982B6F05493FDE2648C1BC29E3E765A7F40857363F3A47A4498DED26A8683543BA466FEA23C67523C9155FE30542CC2FE36F71C23F40ED920A191317F1DAA852B6032885217DE4F0464552E6EA1E0F995122FAC04B93B01B38B91175AC911B82B4C39B92B7CF417DF97774A3A34B1E7645A04D1C5A73A2D2AE133F06C81A85F615F70E6F845273C3E756BCE590F132A055E4F9A972A0481585B0A1F3EE21CB93638D098571584736A73D93DE5862706CBE2A0AF24284929E311239388321ED4B25D272FBE40FF121325A3EB029A9B4C61C17D669CAA4A14C1AB48D4EDC14864BA7E683946B3EB2B5D9E23143F4E9D711E9B95DD8C28DD13181ED26240F7ABA424AABE7A443F153C648312FA43089C54BD4800740E52146F1EFC7751B4705E990471D14F75FDE29522F8E9275475466C2AC15059168CA8628BD7259DF1700A2E6B7F41131F66A5107697ED751046CD2AECC4EFF0D93A58C5DAFC74E376B05579E17101A93428387435DC048E066F96C75D31EE888B8242B9CB270268BBE360503287E7AABBED97100DCA95A1E2C2591964509E7195496DC0441E3B9AD4C5BC5BA54B141FE47FC796161A8A330ED75D86B68B81482F9DD2C7D7E5A2DD705BD2F29914A5436817BE19C75269506411353D8D9D587F3B3754EDC8AC8BBC2AA79BE539D459E06B82B8AC19EA15D74A4B7343D725E6BB56BE081B897A1288637A908F0BA3B48B1D28A02A049445B72BB532447DAF35EA46EF970CAEDF3568813C0D7DD1D94ED5A79F5DCF3625D3A447035D1A8C7ED97B2B9EE3B9A3C75A4AB080D3445B865F83D42FE2C0B99DCC348988A87B8C919A5F0C79C2048D521C7C3B4D3EE5FE19CBF48C775782129256AE786CD286BD45A0F957E0DFD259279A909B25A9D9718B7ADFEF48CD82203606A4E2FC06D4401B9AD754BDA34C17FED40DFBBA0DB0D7FC7145B65291168E0906EDC79326931A783DBABD25FFE2A9B8E8A70BEE73CD51DCD23CD0BEEAA159B9D5C65861DFFFD53D436E712F615729D9E13FEA58A82775687D1E1A8F136260822399CD545F583B81C10EE1AEB573566CDC6416472A9809CBA531D345089C39EE6FFAF901E5F1CD5C9A7D2AC96E074BD4D086AF37F0556D706D8B9B7DACFF125DA422CC60D32C9F201A8891F5027C0C358D2F7434CC2748BD92B1EF5DE40D51BD4D13312A014731E0CEF80425B3BA2640DB9ED61D7DEE39D5306FEABD60A898684C98A1EA3A71B3E63A3FE0686770BB1A8ACB47D1ECA0C33DB08A36C70FDF215C3A55EFD2FFAD84D5930DE2861F784581572CED4A34EB0F1D31CA92640707F5F7C25BD21BA94DDE4651EEDDD71BE7681331CE85C7E949DF9A672552B7D994AC8A9D612DB8002DFC67F6CF5CD723D219DDFFA49916C7A8AD5030D500B0A7CA9755D31061E4A77AD15C9620D4FDD4989E187996B8FDC0567C1AACF1BEDAEDF87418D770079D702AE";
                pubBytes = "000E3EA259CBF7BB2748A52234808340F4D76BE3E603BC7D6ACBB5C9A1D1A2831ADF6744C28AD74BC89F17C47DE9157F21B9D3C340C5755C2FD352682809BC590A98BC14E345947B96F18F5BB4FF51730970884CC46B59801C2BEC5B58EC0229DEADC54CD9931FC936923A5163440D837B8BC035143D91D837E8D8F85A95D43DFE65E8DA1927573E8CA7AFDC01B1CBA43AF1317994862A8B11D0BC432289121B26D1B607B5D85FB691232C505873C6368960BCDBE2454D47DAA4D4D912CA4B133564A9754D49FBC671EAD2A337F6CEA164C426B7F721B87CCF26F185A34F6690E0B971D4751E6B5C9792EA781977E33A3044D475AF87A3C0FEEA1476544E6E47DFD4909B774F3900078E7ABAFBFCDA6B77D018DF5387A9EB5EECDB5D02C9B4CE6007DCBCD1357F59C1B21E45FB5B5FD9CD81DE1BA45D8E597DB935AD9D8F69786A9A37D6F8CB4FDD06AE5A7BC68642D45D7B4BCF846FC281F09FECF22905C73A350957C9A6DFBCEC1131AC6FB0687F7EF436F9FA79F400DD3C2EBD2D104FDF75636A8883F41D05C88B353D75B16F0B6917C6BF68D6BC493DF6492E75A5BA594FE3EB41F83D239FE5F89916AA181BC6F3DDA7F2E74292158E6CB50FB349401D182923C1C53C679B20B3EDA8F5F4F365DC3466275D68E1297BEC4178EE92D3279BD1723BECEE2FE09E21BF35D8F0FDE145B65707F8A2C4822C44C7F85B7E8FFAAED0C29AFB829EAC8D71D3C7878F5F78E81EEB76C42435791A6196499A85671717DB14E7BA3973B1DD50262A5CB47C87B1B81A64975803F87830A9D2C5B1C04EE71C1E9548E61531F658FA88743692D05389D2B750812786C40C55D4516B15AABBFC9A9D7787174C17339D885B43F99D6F7D8235F025AA021F20C11F4C52F52A14534FFE13866A6AD01D8538FB87BC5A42F7ED9E585E24906D3B5E3E4F15A9C66871862FA0D5F1B8091B656B7C962A1716C1DC14A0083D2C59774709F1B0821A762F3F21C7EA8DBE4B538B796EC3D7DCF89F0129246CAF18C21BCB417220FE686701A8E55C7B8A353FE6EF5DDDB763E7F24BE5A599F8F7610C60B8A62F6AF306C54FCA9F3A5125EADC37142098649FE2273A12EF6FB35FA49F33692E928CC6A20C5CE559DA2A30F31974B6AE2BC89DBE6197B8ADEC4A0BC88EA8FCC984711D3BAE6A90E45648B6BA8B7599DDD48DB604ED0720C6BB10E2F4DEF6DD1315A97C19A4CB3E5C4F9B3F6BF6E5BDB2B98BE14305F54AE3A48E6234E5F9793E4BA99A84E553C178242A72D20A985CCCDF6EF410FDE875A9F2E16F487C4EF4A9A4B61EC3E9CC379A16545C73DF9ADAD2C705EEF79137EFD1C7DF6A579513993922A3097B103C8532BCE7D4741D5ED3EB24561A3C95CD6EB1BBCA89ED16B578A05149535B63FC8AD3CD81B3564EB6912B79754BE9C50DCAB337AA1FC450295806AB2ED09A4A2D5C11EA98E8409FF3C4877D6791DB39A3272B8334D3687155D88AA2BB4BDF095D3CA82F60DAC7BAC4F2935221EABC76D2865592F86AE9AD4D696E38828B2B64303E49DDEE73B1FEF5D91987BB444673CEF0441B3DB0E8D0C201C22E46D26CC5CE8C60BE34E0475A5DF77BC2DF236EAE9C3F14DDBFE80A868DAA531020BC022020272A4DCB961468F462C7C96730B10CFC207422CF918B3CC4B5DCD4BE13707B4F21C963A2F51DB0CFC7C50CB18C0A65828E54C6A1C135041FCA3A8C280AAE1DE56343A6772702793E9867BCD335086F2CA8FCFA4FFDD5E01792A9A3976B87C85471AD45F1A651DB5142EA75796F0AB32A35AAE41B8D735930F430D361C14A60D8D72BA433D5467585597171FFF958D95DAC1E7A8093335777B4DFA18C00945C69";
                break;
            case "ML-DSA-65":
                privBytes ="30806f490188b3cb38c0b8b234fa6c56e86d0b226a9185286d5ee804cd379e46545efaaac7e4fa6cd53ee5043df1e727fc850acd0e6bfdce91a71f29beb4b0cfc0e332be33026cbd7e5c20fe7dfaaa786698fac6f3f2dc1270bf71c6c1ee23e949c03c4711ba9d75001c991297f67f845be45523960e068c50df760f5d7bab7d63460723838136763144008225043502765621084418543655357057754762762756831442442234615005680816378167241212723417076184212775366556605018545286175616335063110178415078163131262017432671262583618132145228560640816316128772132535037036465272346082037314234205534408413314352571806501274480464127880165540332735268070535401445887627848007271722100838581226634766510451478634580370186716072223077083772131218638806800364068612553585658657283143508287541676651733528004850804512541288817048603166242706436282281208202015322432158400237058326031765128286204857814680641386682148546451502247554676660211850218628802113857541221372246874468473378000687575160033081000762034005868278037657835035472560518288843565087878461053332475534011702456861157567643140283775335688316453638454642553871067835281425785536146227616182286081824818847887216745708521117255543155321086613226623820561467471373476613111480003413467276517210652731844610281335661704338283107655826145445665587435411272438814115013143587861081486826624070801561000067282161734521061403654367273711568880360078285246310548007170536815282643081666654162146140316506576256442170206718386456463857343473551526421115226146672077261715326652855170330711442362625224238223185800607244243230487184003315576602314107666722837282001680077783300127123301617540174301674221271332563467627122845785582300025241405887175346141060733180205204565217705748842583770814270868856777346120223134077840866428473627115775570375002413006033410823666243848785410754063313244255235804181356020111784666286103058807715445273615715348748502405012265342130003583165528160787784357347013223651422366152008560746181057522447054756115778747577145434358176700145525082028614601143823804504582023607020131210432677338565710853024432632201723168648018746773362660050015834226087206532454883341205467827640146358256437026477707133273237014378465413426163664041255852254416218651764736884530034874670638651785613758272728718647243361427406584712541630156367448288728177558171181651253145420504667131248820120871571361573088001716736228380021176628448648200376355163664010728436374200545810188868263061140528754646250013706001227420446413868670001364744532163347631833867531413133151578127588420011533631502663553740222314643715334774532136768173614630752761267850384724333142786775742774560202038161642238106147528463265875228516588487488811730008123345815448148276860557418223324055022110218451621521663537622670360631776245018616527831602525124823777722487417560002513148704707417327458847882753272240801147774845377644728315067557424100310125265031656716460685880206136356167322138624364853288513434212170720263224760635585871848388804775440054344378302785200010531607306736070776121240538633825345144653113116387380707637321653682556416054325036768504284433244405154542803877734822334008382604857313d167d84076c843155f69d06442013fc25b329e1d08fa60674ee21c06c173e8f91a1d7a7cee8d06094c300a4cf5878f6edd7698bf6d42d61fd998cf89792b770367fd35b63396569214ffcae2c0bf1c1f9ae9fbc729e5f9d049650de2d2f259de7148ea7280619df334f54e8513d2839b0a2ff0a04fd648201ce987531fa8e7faef7ba8abc45049c4bef885e27400f1002d72c93ce5193791e4e6555fc0dd38247f1859cd25e9e20164a374d9be094b5c30b79f0d53d4122a38f18d373961b181af9f56d930837a6387b44eefb999cbaea897c0098a020ceaf4299fd43a676fa378d01c97edcb9c2417b52c19958df38a18efd348783c96562e662d806bcbfa35c9aae5d2563aab604cfe2a1237d132f77ca7e70a9e2e9d2426a72663394366094be2d4ea11232beceaa4b480e1ad28b6444d99c1bc05d5c0e5b796287b91d99612bdb6fce552ab1e99fc5e60588938e71e852881ea7d4227a7bace2e801aa134a81b3cbda647301364dec9340229cea2f549d3721f9f293b8ff0eabb749254badd6009c5e94074290c1e93eefe5f2aa18a573fcb8a17819356190222da5ab92a0cdfade577ad624fb25ffe723d1208e71734391296e4f6f83928950571738baf8534977efaac903d9358e89ec8a565c2ab50d148aef115a40a5f356b793b94f847bf58342123ccb4f7770b30564f14e145faadf0709eb3e7cf6994306b20566d123770414aad2850365d6d2523f577c75177f4bb3a91ab2d3d5d8d8a7ab7d02ba684d2bf64bc7381c42aa4fc90bd08c0971219437eefcba153cbd23e0fd1b799c9d6d72bb92f7b4db6aa21977e6a9d679c5a54485e9c487c2906356e7c24c2ba7bc511349fd99641be6a5fa405cd0aa2798a89835389eba358df2a68f366b0f6508fc592a147602f72eca9b49126ff0d3b1a3ef292bb683e16bacafa88e6bca143256374a93f489f30d720807791dab98be817f41c789592c9f97735e9c6d6e75b2924d97d9dd780e5a20f7e3cac122446bfdb13a8502bcc8e1235601ef6f327162a96a2ea6cb5bad7938ee09ed384155418aece026bb66c3e653d7762ff554c808a1781ec8de32a411a17dba1b3579fa1eebf4c5e1059b3cd334d480396dfd1092fec525d8912f505d1340c716e9d447719719a273d3b68afda8cf4929189b79073927bb29656caa691d395c25c9411041703a76f8a4277ab4b9221173b6256e1cfae0f9f52a28b4adbc7be1d74e299acd87f7fd8957f731ecade0e4f28c5c7f19bdbcaebe920574bf7305d21bbba1d93a670f28d27d75cc680efe68135edee5c50ca243a5144cb2292c21e67eaa6dff7e6cb8f02e03c0be271b98968e7dafd57f6ae5993872ce9f8fbca33332abccfebe99e656c331ea3a4beee3e0c701900232c67ba8fa078dc9df70c9db4ac36ee0d6725b74c4185c4521650316398e3ede52344dde5104be59b6d7e5e6c4d5c6c0a3f3a60b1cd14317eeb06943f3d7a53883242cf7c32c74c49fabc9303c75bfd7f69c782c97e9cd45ced090b01dc81f75c40aaacffd92314a6f0b925c27278277d3be84293c12b39720b8a4a1a097a9c1be51d2db3ac76bb5e14bc4ffcee3351f795d579ad1d42cda9508c0d9bfb85914bbe8da112327fbb7447b4a249a1b0aed8f636b806b6e273fbbdb00241db0fdd104b6d30bce7e3c16ce8f1c7001a726596ab00a6f23c39581122f041b298d1a8a53a3bdac4e32a484a50ab0c9282d7b44c3f0cd2929a6aca6148455c5daf36d16fde83309d2164f377b21575184c2c47ce23e301851980b7bdc680be31c6f8de879ebbccc551ba68f6ef2f82a42d7d5d41a8c1abce3137f08ff1286b0e62d276da534b017f777fefbee4d0a533e55723ccc66a0d09e6f8f0ba308d43331799d19423d591850bb7ec09822c1b21779a539703af95fd347be8a0eedcb2588c0202ba8cd1c224d39b4c679f98d787d1d9d92a765b2197ce292522e2d96d27aa2a80bbf078a6cce661148288f50050fcaa86f6b8cb5529c733711934231333b64a0c534c68efc3eaf5866720fd2b92b5d242c4a53561c2058c4412d2c6bb2ba4f73b0b461a43d244ae283ad236c285050eb55444a1ba172307ba6da16660da1237cae8e1d2cb77f0e4d80d88e81aaeecd3a1cca8beae3f0878314a49a3ab897999f1801dcf28a173b36b15b64994d9d310975c46f53e2b20670069c91036629d97e6d1709826287c04f4f4b14e2c017fa7d1be05ee635da3c0495da5f0f5e786b828d075637931fb9b98cc2a282d30198e49da24beec5ed197d32ea7c96eb824dd5a42a4cbd47b196165dc424264cb20c9d49c1a8f33ff27c2bbb1cc345185a167ca4551f9db688dc5f91e0a258408a6296d65749477f0d5ffd259362d972ab8e3807e27e063ba2b6b19ad5fa8d5aaf3021d1ac385f7bacff3c9592b74fd9f511765aca2827d89d4d564fcb1af3bb12ab476faa6dac5b35fc230ea681f17f0596bb4cf3f3a6c691bdaab0a51b4aa508d6164ceeb17fb7d0c4a73fb5f3bd1701009ece07beff4a9096585780ff73f4ebdac53157387b168e2871839acc950f261352b2df2bb89d4597a32bb19c0eaa84d9698a23a02fb050ab7b8bb585fb69141f6d56a473d912310faeed26ff0fe3b5e29b4d7ecd372f1e26fa13f980a569e46e8d62045b870d01cd325ac4c9aee745f5f2e102ebe6160f9f163ccd605112bc9f4e72b2d4d33ea2d3e1cbeca68279cd966c7b1c6242ee929c74f35040f70f2997a580f39d50d06040bf54c55691b3ace87e9a19aea15fafc98ccc391f81ac7737ac1224555e9bac815296ea382c0c4aa50287f8b8b72cbfdd3ab5923f082c10d210963ed8136a07c0eaae556f812dfe9db220507cbded6a8f42269796f09a6a1a8ffc6c0d9fe52a5c825bfa94e1ea94738a50d441df33a86995d42061cb3398e2507bf0f131c41db4dfe7033ab6814f231d9cd31c54502df6cd169908a2a23ddc52bce352a46eeb120992f345494ab99a48bb91957fd9acd69f134065811939f300e1c6f78065417e1295af7b62bac50dfbe11bda2a0e89d46b42bbe4e47121948f74051324216e26f9e365457bde8d8e18ed936e7320ee38bf18b937a858e6ccc2bc932c9d0df8b568b833860506281c56871e5cde1216b8a8d3ba859fcea9b27e97368dc98ac23d65578cd31aeccf96a8afce598a0116d73f8d4533291cdc2f909821e59541ed3d87af9dcc821225f8c5818dc40ec3902183601f68809b60a50fe90a8a27ada3e19c8decea328bc8e549d73004a402639253cb3a27a95e9de9dbece3092946f0e23d8ffc8da5eee18ce7c25aff770dd2f8e1af5590a9146192f514a0b84de8332a1645d1361fe1098698cf5f24f051a86d0418ab0849200209d8c974fd07f4067b3f9a46506fb09e751976d23f3729305cc7988198e47c7572d6fed5ee0207aed0043abbae6a29ef6b5c1ce118f55c86aad84d545227d905b1812ba6ecd7eeb0abda45a73cd96aa5d17b4c62479c6f1629de1c49bd4fcf7cc4";
                pubBytes = "0030806f490188b3cb38c0b8b234fa6c56e86d0b226a9185286d5ee804cd379e4602aa4d04dc618a699fa73bd85039c7adf9fdf7f614a9e1d0ad4a6400e836874ba97e8849f48eb9bc99eb52203e54b9895c54ae1a688dff4c4d121849c630d8392ff844e430c550e81b968bad39b6dc13df132624b5ddb62388ecb1321e498e1107cf947a4b68e310b2d48c2951ad366446f4b402e7d1e8f437946f41f071d90ee7325a29f5621d3dd757eb962688ee1f21a93ebf175e1a01e6c7726669f399be28b7c9e4f80f00c9ae1f368deeab981f765d5e2c6a1f21536e502ff29fb23ef5429c5ee2b0655af9b7fbb7aebf579db9996a64e7677fb1fdeef77dfd1d3f96e0b82e0c0caf7aacb59ba5a751597c25a444b09a01b816240339ab08ec1c40b0c69b30e0999ed3c5891a0e3df4cb50f561122ce8cbdb63c93eef199ab37725f3362d419ad643c4810ebac83e2d3ebfa6e8fd10d79fa87ad94fd2b9924b9b0c01faacfdb198dae33cac2f4621c1f6414be4ec364514bbfce92a4adc6bc52463ef0e064c0329ed632a4e4aa5a72e911ac9fa96a60696d035978251b8bec722b34207b45452db3d12565612a915a3889cd7ae81531e878e3667fc0d48999f14b4ecba0ab10a8582020f3a9564626998fe5f5362a0441773acff8630fea46f0a9bb8218b8fa3939a54a26303ac0bdfc1b4799d2615bd3ee7ff1b1b3e413df148f2ac33ff553e108bfcf729293298d037fee2775e44058050ef35fd86ab8c59223dadd9b1aecb747b6e776ba5e598ab451614b5fbec1cc1249f188e171003b173eb2a0715a0a937cdfd43fc627796205c55e6d67438e1a21b80dc222e9a4d094063805cb59a822b63ef30ae9a5ac19c8d4d641119def8bad3373eb83118ebaf1dc809ac21a7e0c24394eb7b4954af34581e394abc4726ad37a198b87a1ef18be1b0a954121e7194f75cf804838874c0ab53cebc61ef1bf8bd93f29ff843b36d98b344d2e33a536b207143f4910b02eeb3ccd186f75eb7afc53f207e58a09e1d9df760c1b2bb252837b04243c15363c26fbf2b5c05a7b72d01191acb02ed06df3250a2e7a6ce22016cb36b8f9b50a2de1f9803e923433e49da58e73ee96edee75378e8c61254eca93c026618824bb25575d33822b81a2b4a0b25e3b319863b3f8e1f21e968a49a4acfe2942a7479d94bf947dbf0553df6c12dab8e696a99821264278a0511034e24ba0f9046309f846312e7ef1032101d6086c69ad4280b85c704f8d587d10279f751011becbf1f2b52c41445185ac597672151e8ab42cedbe9fd242cdc78b74f2403804da6ac1dfe3828a9902b973c5c3b480e5ac83688e9c3ecd38bacac9dbc2a2293a6f5f35213f8eba00c5393e92088c6e807cb7cba1dc8f09d6b30bcaaaaf99106eb2487a8291dd61bb977a23ccca60e14d2cb1a8a1f3f72306a75b188ac8f7b7425153ecc55e06367d18cab3b893ca05b9046274445c1d4ace4a46d1122c19ca5892335ba3fd1e742f5212d2493cd5ed7e66ce677258d6d352beca3665358e89ab0979e25ff988bfe03c782c641c4efd757199abb2ed3873503cd368e6fcf16f13f5ff2ba9432bd741b199993c80fbec00c652910d5770fc2ac7214fe1874cc465d68c53ea7903b984df92a01d1e241ece1df02ad917634e429a36fd5fc63e642ddf8ac143e45dcc7cee17fddb72faa595cf338a1a975fed7c6a471750fa3114fc80e25f70a46c1ff4dcf14a4be5658d208377ff17bca28905919f4cde9dc158c6163d4e9f3de34d7138d9f836da80197012a2a8a8a2ae057bd5adf0ff1a24eb26dc4accc70c9ba916ce067b4e0424884c4477b1e325c49f45f3953693b0b6147c5e599f348c2c19ef16f18d376ae4e7f4e86b378a67737b627b6120a44078298914d54c9b8f1cf2b29bf23993b18bba3b38bf9743e48f41905f958cd531ef1f6f94953b6d2332bc7812f1f40dd7d945a00b8ca1b455b04e982d88c338b53782e60e8d44516e1eb574472c19c8608f1f37821b20067f950ef62ca4359117e5906d044a2b06ed5cf41b6f3c8085ffb3054d79c5337dba53d46aef415a43ac93c239f2fa7ff5e99ad78941e170d3df9b249d5cfc9f13599e651810a32b0b9be86800d953293d6890e4acbba9d86e02d990a75e439c9545fa566d90b9db5eaefad35ba7a406d496e024e3e336ae1d68c66858e4776c367ac0959a2a4ea9a028f539427c7037fab3de5fa80f03aed12e9b442ae3dff322118b64171599e6a8f3a6a478da8820a226233979a247a1d68ec071ae11f8904c29c6d22008b94cde90ef549fa8aa497be9562a84ba9467a00a25917763d7378edd6eb830f82f1d2fd5c179d17872d243c6b1a3d979acf1c56851bea6a9fcb638c696a796248abe6e13a635809b58bf519c0ba0525240db22f3c6e526fa455f88303c7f73603b657c1bb137b2949d5ab0dd061ee941524ef025278574a6eb9a12591d5c431f4b645148afb65bb33dac5154b3caf622aa3743f52aa92b2d4be274e65fe39366e2e122d50fa175801c4b097ca2ad2e5072c2fd5f1ef74902aa8fce40165cab2a3f0bd123af7a38510c369964f525fd3e8d8737af6345d04fb7665a02ece9070b71ebece99923687fa949408b49c566907b2191261ee60df5100b86bb0b5e601c3b5bc51e4ac2dd48bbb0c7add8b1908ab39b726ecde99b270893a3ca085f768f2a01334933479a0830f7b7c161a6c223420b881fcdbbe21de5e219e7875079555";
                break;
            default:
                return;
        }
        byte[] privKey = HexFormat.of().parseHex(privBytes);
        byte[] pubKey = HexFormat.of().parseHex(pubBytes);

        pqcKeyFactory = KeyFactory.getInstance(Algorithm, getProviderName());
        
        RawKeySpec pubSpec = new RawKeySpec(pubKey);
        RawKeySpec privSpec = new RawKeySpec(privKey);

        PublicKey publicKey = pqcKeyFactory.generatePublic(pubSpec);
        PrivateKey privateKey = pqcKeyFactory.generatePrivate(privSpec);

        //Need to extract just the key material from the key to do the compare
        byte[] newPubKey = parsePub(publicKey.getEncoded());
        byte[] newPrivKey = parsePriv(privateKey.getEncoded());

        assertArrayEquals(newPubKey, pubKey, "Public key does not match generated public key - "+Algorithm);
        assertArrayEquals(newPrivKey, privKey, "Private key does not match generated public key - "+Algorithm);

    }

    byte[] parsePub(byte[] key) throws InvalidKeyException{
        byte[] keyMaterial = null;

        try {
            DerValue val = new DerValue(key);
            if (val.tag != DerValue.tag_Sequence)
                throw new InvalidKeyException("invalid key format");

            AlgorithmId algid = AlgorithmId.parse(val.data.getDerValue());
            algid.encode();
            keyMaterial = val.data.getUnalignedBitString().toByteArray();
            if (val.data.available() != 0)
                throw new InvalidKeyException ("excess key data");

        } catch (IOException e) {
            throw new InvalidKeyException("Unable to decode key", e);
        }
        return keyMaterial;
    }

    byte[] parsePriv(byte[] key) throws InvalidKeyException {
        byte[] keyMaterial = null;
        try {
            DerValue val = new DerValue(key);
            if (val.tag != DerValue.tag_Sequence) {
                throw new InvalidKeyException("invalid key format");
            }

            int version = val.data.getInteger();
            if (version != 0 && version != 1) {
                throw new InvalidKeyException("unknown version: " + version);
            }
            AlgorithmId algid = AlgorithmId.parse (val.data.getDerValue ());
            algid.encode();

            byte[] tmp = val.data.getOctetString();

            DerValue next;
            if (val.data.available() == 0) {
                // remove octet tag
                keyMaterial =  Arrays.copyOfRange(tmp, 4, tmp.length);
                return keyMaterial;
            }
            next = val.data.getDerValue();
            if (next.isContextSpecific((byte) 0)) {
                if (val.data.available() == 0) {
                    keyMaterial =  Arrays.copyOfRange(tmp, 4, tmp.length);
                    return keyMaterial;
                }
                next = val.data.getDerValue();
            }

            if (next.isContextSpecific((byte) 1)) {
                if (version == 0) {
                    throw new InvalidKeyException("publicKey seen in v1");
                }
                if (val.data.available() == 0) {
                    keyMaterial =  Arrays.copyOfRange(tmp, 4, tmp.length);
                    return keyMaterial;
                }
            }
            throw new InvalidKeyException("Extra bytes");
        } catch (IOException e) {
            throw new InvalidKeyException("Unable to decode key", e);
        }  
    }
}
